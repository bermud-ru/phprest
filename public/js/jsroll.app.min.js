
 /**
 * @app $Id: jsroll.app.min.js
 * @category RIA (Rich Internet Application) / SPA (Single-page Application)
 *
 * Классы RIA / SPA 
 * @author Андрей Новиков andrey (at) novikov (dot) be
 * @status beta
 * @version 0.1.0
 * @revision $Id: jsroll.app.min.js 0004 25/09/2016 21:21:48Z $
 */

(function(e,b){e.model={};var j={_user:null,route:"/",get user(){try{this._user=JSON.parse(storage.getItem("user"));this.route=this._user.path||"/";return this._user}catch(g){return null}},set user(g){this._user=g;storage.setItem("user",g?JSON.stringify(g):"");this.route=g?g.path:"/"}};e.acl=j;var a={box:{},validators:{},formatters:{},field:{},pg:{location:function(l){this.el=l;this.url=l.spa.attr("data-tab-url");this.limit=parseInt(l.spa.attr("data-list-limit"))||10;var m=location.params(this.url);if(this.page){this.page=m.page=parseInt(this.page)-1}else{this.page=m.page=0}m.limit=this.limit;var k=[];for(var g in m){k.push(g+"="+m[g])}l.spa.attr("data-tab-url",this.url.split("?")[0]+"?"+k.join("&"));return this.url.split("?")[0]+"?"+k.join("&")}},clear:function(k){for(var g in this.field){k.spa.attr("data-tab-url",k.spa.attr("data-tab-url").replace(css.re(g+"=.*?(&|$)"),""));this.field[g].el.value=""}},update:function(o){var n="";var m=true;var q=location.params(o.spa.attr("data-tab-url"));for(var l in this.field){n=this.field[l].el.spa.attr("validator");if(n&&a.validators[n]){m=a.validators[n].call(this.field[l].el,l)&m}q[l]=this.field[l].el.value}this.pg.page=q.page=0;var k=[];for(var g in q){k.push(encodeURIComponent(g)+"="+encodeURIComponent(q[g]))}if(this.pg.el){this.pg.el.spa.attr("data-tab-url",this.pg.url.split("?")[0]+"?"+k.join("&"))}return m},paginator:function(g){this.pg.page=g.page;this.pg.count=g.count;this.pg.pages=Math.ceil(this.pg.count/this.pg.limit)}};e.filter=a;e.spa.on("keyup",function(g){if(g.keyCode==27&&popup.visible){popup.hide(function(k){if(!j.user){h()}})}},false);function h(){var g=function(k){spinner=true;JSON.form(spa.el("#login"),function(l){var l=true;if(!l){spinner=false;spa.el(".modal-content.login-form").css.add("has-error");msg.show({message:"неверный <пользователь>:<пароль>!"})}return l}).release({done:function(l){spinner=false;j.user=l.data;popup.hide();c(j)},fail:function(l){spinner=false;spa.el(".modal-content.login-form").css.add("has-error");msg.show(l)}})};tmpl("/tmpl/login.tmpl",null,function(k){popup.show({width:500,height:300,content:k,event:[function(){spa.el('[role="login-submit"]').spa.on("click",g);spa.el('[name="login[email]"]').spa.on("keydown",function(l){if(l.keyCode==13){g.call(this)}});spa.el('[name="login[passwd]"]').spa.on("keydown",function(l){if(l.keyCode==13){g.call(this)}})}]})})}function c(g){spinner=true;tmpl("/tmpl/app.tmpl",g,function(n){spa.el(config.app.container).innerHTML=n||"";var q=function(s){msg.show(s);if(s.error&&Object.keys(a.field).length){for(var r in s.error){if(r in a.field){a.field[r].el.status="error"}}}};var m=function(u,s,t,r){model["tmpl-tab"+s].rows=(u&&u.data.rows)?u.data.rows:[];tmpl("tmpl-tab"+s,model["tmpl-tab"+s],function(v){t.innerHTML=v;if(model["tmpl-tab"+s]&&typeof model["tmpl-tab"+s].bootstrap==="function"){model["tmpl-tab"+s].bootstrap.call(t,u)}if(u&&u.paginator){a.paginator(u.paginator);tmpl("paginator-box",a.pg,function(x){var w=spa.el(".row.paginator"+s);w.innerHTML=x;spa.els(".row.paginator"+s+" a",function(y){y.spa.on("click",function(z){a.pg.page=parseInt(this.getAttribute("page-num"));k(s,t);return false})})})}});spa.els("[filter]",function(y,x){var v=y.getAttribute("name");var w=y.getAttribute("validator");a.field[v]={tabindex:x,item:y,name:v,type:(y.getAttribute("type")?y.getAttribute("type"):"text"),value:(u.filter&&u.filter[v])?((a.formatters[w])?a.formatters[w](u.filter[v]):u.filter[v]):"",ph:y.getAttribute("placeholder"),validator:w};tmpl("filter-box",a.field[v],function(z){y.innerHTML=z;if(a.field[v].type=="text"){a.field[v].el=y.spa.el("input");a.field[v].el.spa.on("keydown",function(A){if(A.keyCode==13){if(a.update(t)){k(s,t)}else{msg.show({message:"поля фильтра заполнены неверно!"})}return false}});y.spa.el("button").spa.on("click",function(A){if(a.update(t)){k(s,t)}else{msg.show({message:"поля фильтра заполнены неверно!"})}return false})}else{if(a.field[v].type=="list"){a.field[v].el=y.spa.el("select");a.field[v].el.spa.on("change",function(A){if(a.update(t)){k(s,t)}else{msg.show({message:"поля фильтра заполнены неверно!"})}return false})}}if(w&&a.validators[w]){a.validators[w].call(a.field[v].el,v)}})});if(r){r.call(this,u)}if(t.spa.el('[role="popup-box"]',"popup_box")){popup_box.spa.on("click",function(w){var v=popup_box.spa.attr("data-form");tmpl("tmpl-add-tab"+s,model["tmpl-tab"+s].row,function(x){popup.show({width:v&&v.width||null,height:v&&v.height||null,content:x,event:[function(){if(model["tmpl-add-tab"+s]&&typeof model["tmpl-add-tab"+s].bootstrap==="function"){model["tmpl-add-tab"+s].bootstrap.call(popup.container,model["tmpl-tab"+s].row)}spa.el('[role="popup-save"]').spa.on("click",function(y){spinner=true;JSON.form(spa.el('[role="form popup"]'),model["tmpl-tab"+s].validator).release({done:function(z){if(model["tmpl-add-tab"+s]){if(typeof model["tmpl-add-tab"+s].submited==="function"){model["tmpl-add-tab"+s].submited.call(this,model["tmpl-tab"+s].row)}if(model["tmpl-add-tab"+s].hasOwnProperty("fclear")&&model["tmpl-add-tab"+s].fclear===true||!model["tmpl-add-tab"+s].hasOwnProperty("fclear")){a.clear(t)}}popup.hide();a.pg.page+=1;k(s,t);spinner=false},fail:function(z){spinner=false;if(z.error){for(var A=0;A<this.elements.length;A++){if(z.error.hasOwnProperty(this.elements[A].name)){this.elements[A].status="error"}else{if(this.elements[A].status=="nene"){this.elements[A].status="nene"}}}}msg.show(z)},rs:{Hash:e.acl.user.hash}})})}]})});return false})}if(spa.el("#tmpl-add-tab"+s)){t.spa.els(".btn.btn-danger.btn-xs",function(v){v.spa.on("click",function(z){var y=spa.src(z).attr("row-info")||spa.src(z).parent.attr("row-info");var x=spa.src(z).attr("row-data")||spa.src(z).parent.attr("row-data");if(confirm("Подтвердите удаление записи ["+y.fio+"] ?")){var A=[];for(var w in x){A.push(encodeURIComponent(w)+"="+encodeURIComponent(x[w]))}o(y.url||e.location.search,A.join("&"),s,t)}return false})});t.spa.els(".is_correct",function(v){v.spa.on("click",function(z){var y=spa.src(z).attr("row-info")||spa.src(z).parent.attr("row-info");var x=spa.src(z).attr("row-data")||spa.src(z).parent.attr("row-data");x.is_correct=this.checked===true?1:0;var A=[];for(var w in x){A.push(encodeURIComponent(w)+"="+encodeURIComponent(x[w]))}return l(y.url||e.location.search,A.join("&"),s,t)})});t.spa.els(".btn.btn-success.btn-xs",function(v){v.spa.on("click",function(z){var y=spa.src(z).attr("row-info")||spa.src(z).parent.attr("row-info");var x=spa.src(z).attr("row-data")||spa.src(z).parent.attr("row-data");x.kind=x.kind==1?0:1;var A=[];for(var w in x){A.push(encodeURIComponent(w)+"="+encodeURIComponent(x[w]))}return p(y.url||e.location.search,A.join("&"),s,t)})});t.spa.els(".btn.btn-info.btn-xs",function(v){v.spa.on("click",function(z){var y=spa.src(z).attr("row-info")||spa.src(z).parent.attr("row-info");var x=spa.src(z).attr("row-data")||spa.src(z).parent.attr("row-data");x.kind=x.kind==2?0:2;var A=[];for(var w in x){A.push(encodeURIComponent(w)+"="+encodeURIComponent(x[w]))}return p(y.url||e.location.search,A.join("&"),s,t)})});t.spa.els(".btn.btn-warning.btn-xs",function(v){v.spa.on("click",function(z){var y=spa.src(z).attr("row-info")||spa.src(z).parent.attr("row-info");var x=spa.src(z).attr("row-data")||spa.src(z).parent.attr("row-data");x.kind=x.kind==3?0:3;var A=[];for(var w in x){A.push(encodeURIComponent(w)+"="+encodeURIComponent(x[w]))}return p(y.url||e.location.search,A.join("&"),s,t)})});t.spa.els("tbody tr",function(w,v){w.spa.on("click",function(A){var y=spa.src(A),z=y.parent.attr("row-data");if(y.instance.tagName=="TD"&&z){tmpl("tmpl-add-tab"+s,model["tmpl-tab"+s].rows[v],function(B){var x=popup_box.spa.attr("data-form");popup.show({width:x&&x.width||null,height:x&&x.height||null,content:B,event:[function(){if(model["tmpl-add-tab"+s]&&typeof model["tmpl-add-tab"+s].bootstrap==="function"){model["tmpl-add-tab"+s].bootstrap.call(popup.container,model["tmpl-tab"+s].row)}var C=spa.el('[role="popup-save"]');if(C){C.spa.on("click",function(D){spinner=true;JSON.form(spa.el('[role="form popup"]'),model["tmpl-tab"+s].validator).release({done:function(E){if(model["tmpl-add-tab"+s]){if(typeof model["tmpl-add-tab"+s].submited==="function"){model["tmpl-add-tab"+s].submited.call(this,model["tmpl-tab"+s].row)}if(model["tmpl-add-tab"+s].hasOwnProperty("fclear")&&model["tmpl-add-tab"+s].fclear===true||!model["tmpl-add-tab"+s].hasOwnProperty("fclear")){a.clear(t)}}popup.hide();a.pg.page+=1;k(s,t);spinner=false},fail:function(E){spinner=false;if(E.error){for(var F=0;F<this.elements.length;F++){if(E.error.hasOwnProperty(this.elements[F].name)){this.elements[F].status="error"}else{if(this.elements[F].status=="nene"){this.elements[F].status="nene"}}}}msg.show(E)},method:z.method||"put",rs:{Hash:e.acl.user.hash}});return false})}}]})})}return false},true)})}};var l=function(s,u,r,t){xhr.request({method:"POST",url:s,data:u,rs:{Hash:g.user.hash}}).result(function(x){if([200,206].indexOf(this.status)<0){msg.show({error:"ОШИБКА",message:this.status+": "+this.statusText})}else{try{var v=JSON.parse(this.responseText);if(v.result=="error"){msg.show(v)}else{a.pg.page+=1}k(r,t)}catch(w){msg.show({message:"сервер вернул не коректные данные"})}}return this});return false};var p=function(s,u,r,t){xhr.request({method:"PUT",url:s,data:u,rs:{Hash:g.user.hash}}).result(function(x){if([200,206].indexOf(this.status)<0){msg.show({error:"ОШИБКА",message:this.status+": "+this.statusText})}else{try{var v=JSON.parse(this.responseText);if(v.result=="error"){msg.show(v)}else{a.pg.page+=1}k(r,t)}catch(w){msg.show({message:"сервер вернул не коректные данные"})}}return this});return false};var o=function(s,u,r,t){xhr.request({method:"DELETE",url:s,data:u,rs:{Hash:g.user.hash}}).result(function(x){if([200,206].indexOf(this.status)<0){msg.show({error:"ОШИБКА",message:this.status+": "+this.statusText})}else{try{var v=JSON.parse(this.responseText);if(v.result=="error"){msg.show(v)}else{k(r,t)}}catch(w){msg.show({message:"сервер вернул не коректные данные"})}}return this})};var k=function(r,s){spinner=true;xhr.request({url:a.pg.location(s),rs:{Hash:g.user.hash}}).result(function(u){spinner=false;if([200,206].indexOf(this.status)<0){q({result:"error",message:this.status+": "+this.statusText+" (URL: "+a.pg.location(s)+")"})}else{try{var t=JSON.parse(this.responseText);m(t,r,s,t.result=="error"?q:null)}catch(u){msg.show({message:"сервер вернул не коректные данные",e:u})}}})};spa.el(".dropdown-toggle").spa.on("click",function(r){css.el(this.parentElement).tgl("open")}).spa.on("blur",function(r){css.el(this.parentElement).del("open")}).setAttribute("tabindex","0");spa.el('[role="logout"]').spa.on("mousedown",function(r){if(confirm("Вы действительно хотите завершить работу?")){css.el(spa.el(".dropdown-toggle").parentElement).del("open");spa.el('[role="workspace"]').innerHTML="";g.user=null;tmpl.cache={};h()}});spa.els("[data-tab]",function(s,r){if(r==0){e.css.el(s.parentElement).add("active");var u=s.getAttribute("data-tab");var v=spa.el('[data-tab-container="'+u+'"]');v.style.display="inherit";tmpl("tmpl-tab"+u,model["tmpl-tab"+u],function(t){v.innerHTML=t;a.pg.page=null;k(u,v);spinner=false})}s.spa.on("click",function(z){var y=spa.el(".nav.nav-tabs li.active"),x=spa.src(z),w=x.instance.getAttribute("data-tab");if(!x.parent.css().has("active")){spinner=true;var t=spa.el(".nav.nav-tabs li.active a").getAttribute("data-tab");fadeOut(spa.el('[data-tab-container="'+t+'"]'),function(){y.css.del("active");x.parent.css().add("active");var A=spa.el('[data-tab-container="'+w+'"]');tmpl("tmpl-tab"+w,model["tmpl-tab"+w],function(B){A.innerHTML=B;a.pg.page=null;k(w,A);spinner=false;fadeIn(A)})})}return false},true)},"tabs")},{rs:{Hash:e.acl.user.hash}})}a.validators.named=function(m){var l=/^[а-яА-ЯёЁ\-\s]+$/i;var g=d(this.spa).instance;if(g.value){var k=l.test(g.value.trim());if(!k){g.status="error"}else{g.status="success"}return k}g.status="none";return true};a.validators.digit=function(m){var l=/^[0-9]+$/i;var g=d(this.spa).instance;if(g.value){var k=l.test(g.value.trim());if(!k){g.status="error"}else{g.status="success"}return k}g.status="none";return true};a.validators.digits=function(m){var l=/^\d{4}|[VIXCM]+-[А-Я]|(80|81|82|83|90)$/i;var g=d(this.spa).instance;if(g.value){var k=l.test(g.value.trim());if(!k){g.status="error"}else{g.status="success"}return k}g.status="none";return true};a.validators.pgdate=function(m){var l=/^(0|1|2|3)\d\.(0|1)\d\.(19|20)\d{2}$/i;var g=d(this.spa).instance;if(g.value){var k=l.test(g.value.trim());if(!k){g.status="error"}else{g.status="success"}return k}g.status="none";return true};a.formatter={};a.formatter.digits=function(l,k,m){if(!k){return l}for(var g in l){if(/\d/.test(l[g])){k=k.replace("_",l[g])}}return !l?m||"":k.replace(/\_/g,"")};e.formvalidator=function(l){var m=function(o){if(o){var n=true;if((o.getAttribute("required")!==null)&&!o.value){n=false}else{if((o.getAttribute("required")===null)&&!o.value){n=true}else{if(o.getAttribute("pattern")===null){n=true}else{try{var r=/[?\/]([^\/]+)\/([^\/]*)/g.exec(o.getAttribute("pattern"))||[];var q=new RegExp(r[1],r[2]);n=q.test(o.value.trim())}catch(s){n=false}}}}var p=d(o.hasOwnProperty("spa")?o.spa:spa.create(o));if(!n){p.instance.status="error"}else{if(!p.instance.hasAttribute("disabled")){if(o.value.length){p.instance.status="success"}else{p.instance.status=null}}}return n}return false};var g=true;for(var k=0;k<this.elements.length;k++){g=g&m(this.elements[k])}if(!g){spinner=false;msg.show({message:"неверно заполнены поля формы!"})}return g};var f=function(l,k){if(l){var g=l.hasOwnProperty("spa")?l:spa.create(l).instance;var m={tmpl:function(p){var o=this.owner;this.index=0;this.key=o.value.toLowerCase()||"null";if(o.pannel){var q=spa.xml(tmpl(this.opt.tmpl,{data:p})).firstChild;if(q){o.pannel.innerHTML=q.innerHTML}}else{o.spa.parent.instance.insertAdjacentHTML("beforeend",tmpl(this.opt.tmpl,{data:p}));o.spa.parent.css().add("dropdown");o.pannel=o.spa.parent.el(".dropdown-menu.list")}o.spa.parent.els(".dropdown-menu.list li",function(n){n.spa.on("mousedown",function(r){o.value=this.innerHTML;if(o.typeahead.opt.key){o.typeahead.opt.key.value=this.spa.attr("value")}return false})})},xhr:function(){var n=this.owner,p={};p[n.name]=n.value;var o=n.value?n.value.toLowerCase():"null";if(!this.cache.hasOwnProperty(o)||o=="null"){n.status="spinner";xhr.request({url:location.update(n.spa.attr("url"),p),rs:{Hash:j.user.hash}}).result(function(s){if([200,206].indexOf(this.status)<0){msg.show({error:"ОШИБКА",message:this.status+": "+this.statusText})}else{try{var q=JSON.parse(this.responseText);if(q.result=="error"){msg.show(q)}else{n.typeahead.cache[o]=q.data;n.typeahead.show(q.data)}}catch(r){msg.show({message:"сервер вернул не коректные данные"})}}n.status="none";return this})}else{n.typeahead.show(this.cache[o])}},show:function(o){var n=this.owner;if(n===e.document.activeElement){if(Object.keys(o).length){this.tmpl(o);return fadeIn(n.pannel)}else{if(n.pannel){n.pannel.innerHTML=null;fadeOut(n.pannel)}}}return false},onKeydown:function(s){var q=(s.charCode&&s.charCode>0)?s.charCode:s.keyCode;var r=this.typeahead,p=r.cache[r.key],o=Object.keys(p||{}).length-1,t=0;switch(q){case 38:for(var n in p){if(t==r.index){this.value=p[n];if(r.opt.key){r.opt.key.value=n}this.selectionStart=this.selectionEnd=this.value.length;if(r.index>0){r.index--}else{r.index=o}s.preventDefault();s.stopPropagation();return false}t++}return false;case 40:for(var n in p){if(t==r.index){this.value=p[n];if(r.opt.key){r.opt.key.value=n}this.selectionStart=this.selectionEnd=this.value.length;if(r.index<o){r.index++}else{r.index=0}s.preventDefault();s.stopPropagation();return false}t++}return false;case 13:this.status="none";fadeOut(this.pannel);s.preventDefault();return s.stopPropagation();default:return false}},onChange:function(q){var o=this.typeahead;if(o.opt.key){o.opt.key.value="";if(this.value&&o.cache.hasOwnProperty(this.value.toLowerCase())){var p=this.typeahead.cache[this.value.toLowerCase()];for(var n in p){if(p[n].toLowerCase()===this.value.toLowerCase()){o.opt.key.value=n}}}return o.opt.key.value}return false},onFocus:function(n){this.typeahead.xhr();return false},onInput:function(n){this.typeahead.xhr();return false},onBlur:function(n){fadeOut(this.pannel);return false}};m.index=0;m.key=null;m.cache={};m.opt={master:[],slave:[],tmpl:"typeahead-tmpl"};g.typeahead=m;m.opt=Object.assign(m.opt,k);g.typeahead.owner=l;d(g.spa).on("focus",m.onFocus).spa.on("input",m.onInput).spa.on("blur",m.onBlur).spa.on("keydown",m.onKeydown).spa.on("change",m.onChange);if(!g.spa.attr("tabindex")){g.spa.attr("tabindex","0")}return g}};e.typeahead=f;var d=function(l){if(l&&!l.instance.hasOwnProperty("status")){var k=l.parent;l.instance.chk=k.el("span");Object.defineProperty(l.instance,"status",{set:function g(m){k.css().add("has-feedback").del("has-error").del("has-warning").del("has-success");if(this.chk){this.chk.css.del("glyphicon-ok").del("glyphicon-warning-sign").del("glyphicon-remove").del("spinner")}switch(m){case"error":this._status="error";if(this.chk){this.chk.css.add("glyphicon-remove")}k.css().add("has-error");break;case"warning":this._status="warning";if(this.chk){this.chk.css.add("glyphicon-warning-sign")}k.css().add("has-warning");break;case"success":this._status="success";if(this.chk){this.chk.css.add("glyphicon-ok")}k.css().add("has-success");break;case"spinner":this._status="spinner";if(this.chk){this.chk.css.add("spinner")}break;case"none":default:this._status="none"}},get:function g(){return this._status}})}return l};e.inputer=d;var i=function(g,l){var k=d(g);if(k.instance.tagName==="INPUT"){if(l){k.instance.maxLength=k.attr("placeholder",l||"").attr("placeholder").length}if(!k.attr("tabindex")){k.attr("tabindex","0")}if(k&&!k.instance.hasOwnProperty("insertDigit")){k.instance.insertDigit=function(r,p){if(p){var t=this.value.indexOf(p);var q=/\d/.test(r)?1:0;var m=this.spa.attr("placeholder").substr(t,p.length).indexOf("_");if(m>0){t+=m}this.value=this.value.substr(0,t)+(/\d/.test(r)?r:"")+this.spa.attr("placeholder").substr(t+q,p.length-q)+this.value.substr(t+p.length,this.value.length);this.selectionStart=this.e1=this.selectionEnd=this.s1=t+1}else{if(/\d/.test(r)&&(this.value||this.spa.attr("placeholder")).indexOf("_")>-1){var s=this.value||this.spa.attr("placeholder");var t=(s).indexOf("_");var o=s.match(/\d/)?(s.indexOf(s.match(/\d/))):-1;if(t<=this.selectionStart||o<0||o>t){this.value=(this.value||this.spa.attr("placeholder")).replace("_",r);t=(this.value||this.spa.attr("placeholder")).indexOf("_");this.e1=this.selectionEnd=this.selectionStart=this.s1=t>-1?t:this.value.length}else{if(t>this.selectionStart){this.s1=t=this.selectionStart;var s=r+(this.value.substr(t,this.value.length).match(/\d+/g)||[]).join("")+"_";for(var n=0;n<s.length-1;n++){t=this.value.indexOf(s.charAt(n+1),t);if(t>-1){this.value=this.value.substr(0,t)+s.charAt(n)+this.value.substr(t+1,this.value.length)}}this.selectionStart=this.e1=this.selectionEnd=++this.s1}}}}return this.selectionStart};k.instance.init=function(m){var o=this.value;var p=0;if(o){this.value=this.spa.attr("placeholder");p=this.value.indexOf("_");for(var n in o){if(/\d/.test(o[n])){this.value=this.value.replace("_",o[n]);p=this.value.indexOf("_")}}}else{if(!m){this.value=this.spa.attr("placeholder")}p=this.spa.attr("placeholder").indexOf("_")}if(m){this.value=this.value.replace(/\_/g,"")}return this.e1=this.selectionEnd=this.selectionStart=this.s1=(p>-1?p:this.value.length)}}k.instance.init(true);k.on("keydown",function(q){if(this.spa.attr("placeholder").length&&!this.value){this.value=this.spa.attr("placeholder");this.e1=this.selectionEnd=this.selectionStart=this.s1=0}var o=window.getSelection().toString();var t=(q.charCode&&q.charCode>0)?q.charCode:q.keyCode;var s=((t>=96&&t<=105))?(t-96).toString():String.fromCharCode(t);switch(t){case 8:if(o){var r=this.value.indexOf(o);this.value=this.value.substr(0,r)+this.spa.attr("placeholder").substr(r,o.length)+this.value.substr(r+o.length,this.value.length);var n=this.spa.attr("placeholder").substr(r,o.length).indexOf("_");if(n>0){r+=n}this.selectionStart=this.e1=this.selectionEnd=this.s1=r}else{this.e1=this.s1=--this.selectionStart;--this.selectionEnd;while((this.s1>=0)&&!/\d/.test(this.value.charAt(this.s1))){this.s1=--this.selectionStart;--this.selectionEnd}if(this.s1>=0&&/\d/.test(this.value.charAt(this.s1))){this.value=this.value.substr(0,this.s1)+"_"+this.value.substr((this.s1+1),this.value.length)}else{this.s1=this.e1+1}this.selectionStart=this.selectionEnd=this.s1}break;case 9:var m=false;var u=q.shiftKey?-1:1;var p=parseInt(this.spa.attr("tabindex"));if(p>0){while(m=spa.el('[tabindex="'+p+'"]')){if(m.spa.attr("disabled")){p+=u}else{m.focus();break}}}if(p<=1&&u<0){return q.preventDefault()}q.stopPropagation();return false;case 37:this.s1=--this.selectionStart;this.e1=--this.selectionEnd;break;case 39:this.s1=++this.selectionStart;break;default:this.insertDigit(s,o)}q.preventDefault();q.stopPropagation();return/d/.test(s)},false).spa.on("focus",function(m){this.init(false);m.preventDefault();m.stopPropagation();return false},false).spa.on("blur",function(m){if(this.value.match(/[\d]+/g)){this.value=this.value.replace(/\_/g,"")}else{this.value=""}m.preventDefault();m.stopPropagation();return false},false).spa.on("paste",function(o){var p=o.clipboardData.getData("Text").match(/\d+/g)?o.clipboardData.getData("Text").match(/\d+/g).join(""):"";var n=window.getSelection().toString();for(var m in p){this.insertDigit(p[m],n)}o.preventDefault();o.stopPropagation();return false},false)}return k};e.maskedigits=i;if(!j.user){h()}else{c(j)}}(window));